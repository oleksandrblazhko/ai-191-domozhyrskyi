# Тестування на наявність HTML-ін'єкцій

## Короткий опис

HTML ін'єкція - це тип вразливості ін'єкції, яка виникає, коли користувач може керувати точкою введення та впроваджувати довільний HTML-код на вразливу веб-сторінку. Ця вразливість може мати багато наслідків, таких як розкриття сесійних файлів користувача, які можна використовувати для піддавання вищезгаданого користувача, або загалом, це може дозволити зловмиснику модифікувати зміст сторінки, який бачать жертви.

Ця вразливість виникає, коли введення користувача не правильно очищено і вивід не кодується. Ін'єкція дозволяє зловмиснику надсилати зловмисну HTML-сторінку жертві. Орієнтовний браузер не зможе відрізнити (довіряти) законні частини від зловмисних частин сторінки і, отже, розбиратиме і виконуватиме всю сторінку в контексті жертви.

Існує велика кількість методів і атрибутів, які можна використовувати для відображення вмісту HTML. Якщо ці методи надаються ненадійним введенням, існує висока ймовірність вразливості ін'єкції HTML. Наприклад, зловмисний HTML-код може вводитися через метод innerHTML JavaScript, який зазвичай використовується для відображення HTML-коду, введеного користувачем. Якщо рядки не правильно очищені, цей метод може дозволити ін'єкцію HTML. Функція JavaScript, яку можна використовувати для цієї мети, - document.write().

У наступному прикладі показано фрагмент вразливого коду, який дозволяє використовувати неперевірений ввід для створення динамічного HTML в контексті сторінки:

var userposition=location.href.indexOf("user=");
var user=location.href.substring(userposition+5);
document.getElementById("Welcome").innerHTML=" Привіт, "+user;

У наступному прикладі показано вразливий код, який використовує функцію document.write():

var userposition=location.href.indexOf("user=");
var user=location.href.substring(userposition+5);
document.write("<h1>Привіт, " + user +"</h1>");

В обох прикладах цю вразливість можна використовувати з введенням такого виду:

http://вразливийсайт/сторінка.html?user=<img%20src='aaa'%20onerror=alert(1)>

Цей ввід додасть тег зображення на сторінку, який виконає довільний JavaScript-код, вставлений зловмисним користувачем в контексті HTML.

## Цілі тестування

Визначте точки HTML-ін'єкції та оцініть серйозність впровадженого вмісту.

## Як тестувати

HTML-код містить наступний скрипт:

<script src="../js/jquery-1.7.1.js"></script>
<script>
function setMessage(){
    var t=location.hash.slice(1);
    $("div[id="+t+"]").text("DOM тепер завантажено та його можна змінювати.");
}
$(document).ready(setMessage  );
$(window).bind("hashchange",setMessage)
</script>
<body>
    <script src="../js/embed.js"></script>
    <span><a href="#message" > Показати тут</a><div id="message">Показ повідомлення1</div></span>
    <span><a href="#message1" > Показати тут</a><div id="message1">Показ повідомлення2</div>
    <span><a href="#message2" > Показати тут</a><div id="message2">Показ повідомлення3</div>
</body>

Можливе введення HTML-коду.

